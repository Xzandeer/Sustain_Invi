{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Z:/code/app/api/forecast/route.ts"],"sourcesContent":["import { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { sales } = await req.json();\r\n\r\n    if (!sales || !Array.isArray(sales)) {\r\n      return new Response(JSON.stringify({ error: \"Invalid sales data\" }), {\r\n        status: 400,\r\n      });\r\n    }\r\n\r\n    const apiKey = process.env.GOOGLE_API_KEY;\r\n    if (!apiKey) {\r\n      return new Response(JSON.stringify({ error: \"Missing API Key\" }), {\r\n        status: 500,\r\n      });\r\n    }\r\n\r\n    const genAI = new GoogleGenerativeAI(apiKey);\r\n    const model = genAI.getGenerativeModel({\r\n      model: \"gemini-2.5-flash\",\r\n    });\r\n\r\n    const prompt = `\r\n      You must respond ONLY with valid JSON. No markdown. No backticks.\r\n      Forecast the next 7 days of sales based on this list:\r\n      ${JSON.stringify(sales)}\r\n\r\n      Return EXACTLY this structure:\r\n      {\r\n        \"forecast\": [7 numbers],\r\n        \"analysis\": \"short explanation\"\r\n      }\r\n    `;\r\n\r\n    const result = await model.generateContent(prompt);\r\n    let text = await result.response.text();\r\n\r\n    // Remove Markdown formatting like ```json\r\n    text = text.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\r\n\r\n    // Try parsing safely\r\n    let json;\r\n    try {\r\n      json = JSON.parse(text);\r\n    } catch (err) {\r\n      console.error(\"JSON parse failed. Raw text:\", text);\r\n      return new Response(\r\n        JSON.stringify({ error: \"AI returned invalid JSON\" }),\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    return new Response(JSON.stringify(json), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Forecast API error:\", error);\r\n    return new Response(JSON.stringify({ error: error.message }), {\r\n      status: 500,\r\n    });\r\n  }\r\n }"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAEhC,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,QAAQ;YACnC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAqB,IAAI;gBACnE,QAAQ;YACV;QACF;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACX,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAkB,IAAI;gBAChE,QAAQ;YACV;QACF;QAEA,MAAM,QAAQ,IAAI,sLAAkB,CAAC;QACrC,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YACrC,OAAO;QACT;QAEA,MAAM,SAAS,CAAC;;;MAGd,EAAE,KAAK,SAAS,CAAC,OAAO;;;;;;;IAO1B,CAAC;QAED,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;QAC3C,IAAI,OAAO,MAAM,OAAO,QAAQ,CAAC,IAAI;QAErC,0CAA0C;QAC1C,OAAO,KAAK,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;QAE5D,qBAAqB;QACrB,IAAI;QACJ,IAAI;YACF,OAAO,KAAK,KAAK,CAAC;QACpB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA2B,IACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,OAAO;YACxC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,IAAI;YAC5D,QAAQ;QACV;IACF;AACD"}}]
}